import{a as f,t as _}from"../chunks/disclose-version.CM6f1PTD.js";import{p as gt,a as ht,g as t,b as a,c as l,r as o,t as j,s,d as v,i as xt}from"../chunks/runtime.g0my00JR.js";import{s as b}from"../chunks/render.pmuW5QOO.js";import{i as H}from"../chunks/if.DVEvk735.js";import{e as ot,i as st}from"../chunks/each.BeKM084r.js";import{e as A}from"../chunks/utils.sCj8HAia.js";import{r as W}from"../chunks/misc.CY9ixZp3.js";import{s as yt}from"../chunks/class.tYA33czU.js";import{b as X}from"../chunks/input.N22HgeA5.js";import{b as wt}from"../chunks/select.BRIlu2rr.js";import{p as kt}from"../chunks/event-modifiers.CWmzcjye.js";import{i as Et}from"../chunks/lifecycle.6aQbxLMK.js";import{o as Gt}from"../chunks/index-client.v1G0sw0w.js";/* empty css                         */import{s as S}from"../chunks/supabaseClient.CaMOPPuz.js";import{g as St}from"../chunks/entry.CFewmVp1.js";var Dt=_("<div><span> </span></div>"),Lt=_("<option> </option>"),Nt=_('<div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center"><div class="p-6 rounded-lg shadow-xl w-96 bg-gray-700"><h2 class="text-xl font-semibold mb-4 "> </h2> <form><div class="form-control mb-4"><label for="name" class="label">Name</label> <textarea id="name" placeholder="Enter goal name" class="textarea textarea-bordered w-full " required></textarea></div> <div class="form-control mb-4"><label for="description" class="label">Description</label> <textarea id="description" placeholder="Enter description" class="textarea textarea-bordered w-full " required></textarea></div> <div class="form-control mb-4"><label for="kpi" class="label">KPI</label> <textarea id="kpi" placeholder="Enter KPI" class="textarea textarea-bordered w-full " required></textarea></div> <div class="form-control mb-4"><label for="lead_id" class="label">Select Lead</label> <select id="lead_id" class="select select-bordered w-full"><option disabled selected>Select a lead</option><!></select></div> <button type="submit" class="btn btn-primary w-full "> </button></form> <button class="btn btn-secondary mt-4 w-full ">Close</button></div></div>'),jt=_('<div class="flex justify-center items-center py-6"><span class="loading loading-spinner text-primary">Loading...</span></div>'),At=_('<div class="text-center py-4  text-lg">No strategic goals found.</div>'),Ct=_('<tr><td> </td><td> </td><td> </td><td> </td><td> </td><td class="flex justify-center space-x-2"><button class="btn btn-sm bg-teal-500 hover:bg-teal-600 text-white font-medium">View</button> <button class="btn btn-sm bg-blue-600 hover:bg-blue-700 text-white font-medium">Edit</button> <button class="btn btn-sm bg-red-600 hover:bg-red-700  text-white font-medium">Delete</button></td></tr>'),It=_('<table class="table table-zebra w-full"><thead><tr><th>Goal No</th><th>Name</th><th>Description</th><th>KPI</th><th>Lead</th><th>Actions</th></tr></thead><tbody></tbody></table>'),Mt=_('<div class="container bg-base-300 mx-auto p-4"><!> <!> <h1 class=" text-3xl font-bold mb-4">Strategic Goals</h1> <button class="btn btn-primary text-white font-medium mb-5 ">Add Strategic Goal</button> <!> <!></div>');function Xt(lt,it){gt(it,!1);let C=v(!1),I=0,D=v(""),L=v(""),N=v(""),g=v(null),h=v([]),P=v([]),M=v(!1),c=v(!1),z=v(null),Y=v(null);const nt=async()=>{a(c,!0);const{data:e,error:r}=await S.from("leads").select("id, name");a(c,!1),r?m("Error fetching leads","error"):a(P,e)},O=async()=>{a(c,!0);const{data:e,error:r}=await S.from("strategic_goals").select("*").order("goal_no",{ascending:!0});a(c,!1),r?m("Error fetching strategic goals","error"):(a(h,e),I=t(h).length>0?Math.max(...t(h).map(i=>i.goal_no))+1:1)},dt=async()=>{a(c,!0);const{error:e}=await S.from("strategic_goals").insert([{goal_no:I,name:t(D),description:t(L),kpi:t(N),lead_id:t(g)}]);a(c,!1),e?m("Error creating goal","error"):(m("Goal created successfully","success"),J(),O())},ct=async()=>{a(c,!0);const{error:e}=await S.from("strategic_goals").update({name:t(D),description:t(L),kpi:t(N),lead_id:t(g)}).match({goal_no:I});a(c,!1),e?m("Error updating goal","error"):(m("Goal updated successfully","success"),J(),O())},vt=async e=>{a(c,!0);const{error:r}=await S.from("strategic_goals").delete().match({id:e});if(r)m("Error deleting goal","error");else{const{data:i,error:u}=await S.from("strategic_goals").select("*").order("goal_no",{ascending:!0});if(u)m("Error reordering goals","error");else{for(let n=0;n<i.length;(n+=1)-1)await S.from("strategic_goals").update({goal_no:n+1}).match({id:i[n].id});m("Goal deleted and reordered successfully","success"),O()}}a(c,!1)},m=(e,r)=>{a(z,e),a(Y,r),setTimeout(()=>{a(z,null)},3e3)},mt=()=>{a(C,!1),I=t(h).length>0?Math.max(...t(h).map(e=>e.goal_no))+1:1,a(D,""),a(L,""),a(N,""),a(g,null),a(M,!0)},ut=e=>{a(C,!0),I=e.goal_no,a(D,e.name),a(L,e.description),a(N,e.kpi),a(g,e.lead_id),a(M,!0)},J=()=>{a(M,!t(M))},bt=e=>{const r=t(P).find(i=>i.id===e);return r?r.name:"No Lead Assigned"},pt=e=>{St(`/plans/${e}`)};Gt(()=>{nt(),O()}),Et();var Q=Mt(),Z=l(Q);H(Z,()=>t(z),e=>{var r=Dt(),i=l(r),u=l(i,!0);o(i),o(r),j(()=>{yt(r,`alert alert-${t(Y)??""} mb-4 text-white`),b(u,t(z))}),f(e,r)});var tt=s(Z,2);H(tt,()=>t(M),e=>{var r=Nt(),i=l(r),u=l(i),n=l(u);o(u);var p=s(u,2),x=l(p),T=s(l(x),2);W(T),o(x);var y=s(x,2),B=s(l(y),2);W(B),o(y);var w=s(y,2),U=s(l(w),2);W(U),o(w);var k=s(w,2),$=s(l(k),2);j(()=>{t(g),xt(()=>{t(P)})});var E=l($);E.value=(E.__value=null)==null?"":null;var R=s(E);ot(R,1,()=>t(P),st,(d,G)=>{var K=Lt(),rt={},_t=l(K,!0);o(K),j(()=>{rt!==(rt=t(G).id)&&(K.value=(K.__value=t(G).id)==null?"":t(G).id),b(_t,t(G).name)}),f(d,K)}),o($),o(k);var q=s(k,2),V=l(q);o(q),o(p);var F=s(p,2);o(i),o(r),j(()=>{b(n,`${(t(C)?"Edit":"Create")??""} Strategic Goal`),b(V,`${(t(C)?"Update":"Create")??""} Goal`)}),X(T,()=>t(D),d=>a(D,d)),X(B,()=>t(L),d=>a(L,d)),X(U,()=>t(N),d=>a(N,d)),wt($,()=>t(g),d=>a(g,d)),A("submit",p,kt(function(...d){var G;(G=t(C)?ct:dt)==null||G.apply(this,d)})),A("click",F,J),f(e,r)});var et=s(tt,4),at=s(et,2);H(at,()=>t(c),e=>{var r=jt();f(e,r)});var ft=s(at,2);H(ft,()=>t(h).length===0&&!t(c),e=>{var r=At();f(e,r)},e=>{var r=It(),i=s(l(r));ot(i,5,()=>t(h),st,(u,n)=>{var p=Ct(),x=l(p),T=l(x,!0);o(x);var y=s(x),B=l(y,!0);o(y);var w=s(y),U=l(w,!0);o(w);var k=s(w),$=l(k,!0);o(k);var E=s(k),R=l(E,!0);j(()=>b(R,bt(t(n).lead_id))),o(E);var q=s(E),V=l(q),F=s(V,2),d=s(F,2);o(q),o(p),j(()=>{b(T,t(n).goal_no),b(B,t(n).name),b(U,t(n).description),b($,t(n).kpi)}),A("click",V,()=>pt(t(n).id)),A("click",F,()=>ut(t(n))),A("click",d,()=>vt(t(n).id)),f(u,p)}),o(i),o(r),f(e,r)}),o(Q),A("click",et,mt),f(lt,Q),ht()}export{Xt as component};
