import{a as c,t as f,b as V}from"../chunks/disclose-version.CM6f1PTD.js";import{p as we,a as ye,b as n,g as e,d as u,c as s,r,t as A,s as i,f as Ue,m as Z,i as le}from"../chunks/runtime.g0my00JR.js";import{s as k}from"../chunks/render.pmuW5QOO.js";import{i as w}from"../chunks/if.DVEvk735.js";import{e as oe,i as ne}from"../chunks/each.BeKM084r.js";import{r as de,s as Ae}from"../chunks/attributes.BVavg5V5.js";import{s as ee}from"../chunks/class.tYA33czU.js";import{e as j}from"../chunks/utils.sCj8HAia.js";import{b as ve}from"../chunks/input.N22HgeA5.js";import{b as me}from"../chunks/select.BRIlu2rr.js";import{i as Ee}from"../chunks/lifecycle.6aQbxLMK.js";import{o as De}from"../chunks/index-client.v1G0sw0w.js";/* empty css                         */import{s as C,a as Ne}from"../chunks/supabaseClient.CaMOPPuz.js";var ke=f("<div><div><span> </span></div></div>"),Re=f('<img alt="Profile" class="w-10 h-10 rounded-full">'),Se=f('<div class="w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-gray-500">N/A</div>'),Pe=f('<span class="text-green-500 font-medium">Verified</span>'),qe=f('<span class="text-red-500 font-medium">Not Verified</span>'),Fe=f("<button><!></button>"),Le=f('<tr class="hover:bg-gray-800"><td><!></td><td> </td><td> </td><td> </td><td> </td><td> </td><td><!></td><td><button class="btn btn-sm bg-blue-600 hover:bg-blue-700 text-white font-medium">Edit</button> <!> <button><!></button></td></tr>'),$e=f("<option> </option>"),Me=f('<label for="department" class="label text-white">Department</label> <select id="department" class="select select-bordered w-full"><option disabled>Select Department</option><!></select>',1),Te=f('<span class="loading loading-spinner">Saving...</span>'),Ve=f('<div class="modal modal-open"><div class="modal-box bg-base-200"><h3 class="font-bold text-lg">Edit User</h3> <div class="py-4"><label for="first_name" class="label text-white">First Name</label> <input id="first_name" type="text" class="input input-bordered w-full"> <label for="last_name" class="label text-white">Last Name</label> <input id="last_name" type="text" class="input input-bordered w-full"> <label for="role" class="label text-white">Role</label> <select id="role" class="select select-bordered w-full"><option disabled>Select Role</option><option>Admin</option><option>User</option></select> <!></div> <div class="modal-action"><button class="btn btn-secondary">Cancel</button> <button class="btn btn-success"><!></button></div></div></div>'),je=f('<div class="min-h-screen bg-base-300 p-8"><!> <h1 class="text-2xl font-bold mb-4">User List</h1> <div class="overflow-x-auto"><table class="table w-full shadow-lg rounded-lg"><thead><tr><th>Profile</th><th>First Name</th><th>Last Name</th><th>Email</th><th>Role</th><th>Department</th><th>Status</th><th>Actions</th></tr></thead><tbody></tbody></table></div> <!></div>');function et(ce,pe){we(pe,!1);let b=u([]),z=u([]),m=u(null),E=u(null),h=u(""),I=u(!1),te=u(""),ae=u("success"),B=u(!1),$=u(null),M=u(null);De(async()=>{await _e(),await fe()});async function _e(){const{data:a,error:t}=await C.from("departments").select("id, name");t?_("Error fetching departments: "+t.message,"error"):n(z,a||[])}async function fe(){const{data:a,error:t}=await C.from("profiles").select("id, first_name, last_name, email, role, department_id, profile_pic, is_verified");t?_("Error fetching users: "+t.message,"error"):n(b,(a||[]).map(o=>{var v;return{...o,department_name:((v=e(z).find(g=>g.id===o.department_id))==null?void 0:v.name)||"N/A"}}))}const _=(a,t)=>{n(te,a),n(ae,t),n(I,!0),setTimeout(()=>{n(I,!1)},3e3)},ue=a=>{n(m,{...a}),n(E,a.department_id||null),n(h,a.role||"")},be=async()=>{if(e(m)){if(!e(h)||e(h)!=="admin"&&!e(E)){_("Role or department selection is missing.","error");return}n(B,!0);const{error:a}=await C.from("profiles").update({first_name:e(m).first_name,last_name:e(m).last_name,department_id:e(h)!=="admin"?e(E):null,role:e(h)}).eq("id",e(m).id);if(a)_("Error updating profile: "+a.message,"error");else{const t=e(b).findIndex(o=>{var v;return o.id===((v=e(m))==null?void 0:v.id)});t>=0&&Z(b,e(b)[t]={...e(b)[t],first_name:e(m).first_name,last_name:e(m).last_name,department_id:e(E)||void 0,role:e(h)}),_("Profile updated successfully!","success"),n(m,null)}n(B,!1)}},he=async a=>{n($,a);try{const{error:t}=await C.from("profiles").update({is_verified:!0}).eq("id",a);t?_("Failed to approve user: "+t.message,"error"):(_("User approved successfully!","success"),n(b,e(b).map(o=>o.id===a?{...o,is_verified:!0}:o)))}catch{_("An unexpected error occurred.","error")}finally{n($,null)}},ge=async a=>{n(M,a);try{const{error:t}=await Ne.auth.admin.deleteUser(a);if(t){_("Error deleting user from authentication: "+t.message,"error");return}const{error:o}=await C.from("profiles").delete().eq("id",a);o?_("Error deleting user profile: "+o.message,"error"):(n(b,e(b).filter(v=>v.id!==a)),_("User deleted successfully!","success"))}catch{_("An unexpected error occurred.","error")}finally{n(M,null)}};Ee();var J=je(),re=s(J);w(re,()=>e(I),a=>{var t=ke(),o=s(t),v=s(o),g=s(v,!0);r(v),r(o),r(t),A(()=>{ee(t,`alert alert-${e(ae)??""} shadow-lg mb-4`),k(g,e(te))}),c(a,t)});var K=i(re,4),se=s(K),ie=i(s(se));oe(ie,5,()=>e(b),ne,(a,t)=>{var o=Le(),v=s(o),g=s(v);w(g,()=>e(t).profile_pic,d=>{var l=Re();A(()=>Ae(l,"src",e(t).profile_pic)),c(d,l)},d=>{var l=Se();c(d,l)}),r(v);var D=i(v),R=s(D,!0);r(D);var N=i(D),T=s(N,!0);r(N);var S=i(N),O=s(S,!0);r(S);var P=i(S),G=s(P,!0);r(P);var y=i(P),Q=s(y,!0);r(y);var p=i(y),U=s(p);w(U,()=>e(t).is_verified,d=>{var l=Pe();c(d,l)},d=>{var l=qe();c(d,l)}),r(p);var q=i(p),F=s(q),H=i(F,2);w(H,()=>!e(t).is_verified,d=>{var l=Fe(),W=s(l);w(W,()=>e($)===e(t).id,X=>{var Y=V("Approving...");c(X,Y)},X=>{var Y=V("Approve");c(X,Y)}),r(l),A(()=>{ee(l,`btn btn-sm bg-green-600 hover:bg-green-700 text-white font-medium ${(e($)===e(t).id?"loading":"")??""}`),l.disabled=e($)===e(t).id}),j("click",l,()=>he(e(t).id)),c(d,l)});var x=i(H,2),L=s(x);w(L,()=>e(M)===e(t).id,d=>{var l=V("Deleting...");c(d,l)},d=>{var l=V("Delete");c(d,l)}),r(x),r(q),r(o),A(()=>{k(R,e(t).first_name),k(T,e(t).last_name),k(O,e(t).email),k(G,e(t).role),k(Q,e(t).department_name),ee(x,`btn btn-sm bg-red-600 hover:bg-red-700 text-white font-medium ${(e(M)===e(t).id?"loading":"")??""}`),x.disabled=e(M)===e(t).id}),j("click",F,()=>ue(e(t))),j("click",x,()=>ge(e(t).id)),c(a,o)}),r(ie),r(se),r(K);var xe=i(K,2);w(xe,()=>e(m),a=>{var t=Ve(),o=s(t),v=i(s(o),2),g=i(s(v),2);de(g);var D=i(g,4);de(D);var R=i(D,4);A(()=>{e(h),le(()=>{})});var N=s(R);N.value=((N.__value="")==null,"");var T=i(N);T.value=(T.__value="admin")==null?"":"admin";var S=i(T);S.value=(S.__value="user")==null?"":"user",r(R);var O=i(R,2);w(O,()=>e(h)!=="admin",p=>{var U=Me(),q=i(Ue(U),2);A(()=>{e(E),le(()=>{e(z)})});var F=s(q);F.value=((F.__value="")==null,"");var H=i(F);oe(H,1,()=>e(z),ne,(x,L)=>{var d=$e(),l={},W=s(d,!0);r(d),A(()=>{l!==(l=e(L).id)&&(d.value=(d.__value=e(L).id)==null?"":e(L).id),k(W,e(L).name)}),c(x,d)}),r(q),me(q,()=>e(E),x=>n(E,x)),c(p,U)}),r(v);var P=i(v,2),G=s(P),y=i(G,2),Q=s(y);w(Q,()=>e(B),p=>{var U=Te();c(p,U)},p=>{var U=V("Save");c(p,U)}),r(y),r(P),r(o),r(t),A(()=>y.disabled=e(B)),ve(g,()=>e(m).first_name,p=>Z(m,e(m).first_name=p)),ve(D,()=>e(m).last_name,p=>Z(m,e(m).last_name=p)),me(R,()=>e(h),p=>n(h,p)),j("click",G,()=>n(m,null)),j("click",y,be),c(a,t)}),r(J),c(ce,J),ye()}export{et as component};
