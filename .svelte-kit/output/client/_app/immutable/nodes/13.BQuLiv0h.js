import{a as v,t as f,b as lt}from"../chunks/disclose-version.CM6f1PTD.js";import{p as ct,t as q,a as dt,m as pt,g as e,b as p,d as _,s as c,c as n,f as bt,r as i,i as z}from"../chunks/runtime.g0my00JR.js";import{s as K}from"../chunks/render.pmuW5QOO.js";import{i as M}from"../chunks/if.DVEvk735.js";import{e as ut,i as vt}from"../chunks/each.BeKM084r.js";import{e as u}from"../chunks/utils.sCj8HAia.js";import{r as $}from"../chunks/misc.CY9ixZp3.js";import{s as _t}from"../chunks/class.tYA33czU.js";import{b as P}from"../chunks/input.N22HgeA5.js";import{i as gt}from"../chunks/lifecycle.6aQbxLMK.js";import{s as mt,a as ft}from"../chunks/store.6LPOOnpP.js";import{s as E}from"../chunks/supabaseClient.CaMOPPuz.js";import{o as ht}from"../chunks/index-client.v1G0sw0w.js";import{p as xt}from"../chunks/stores.C8ewMCja.js";var yt=f('<h5 class="text-md font-semibold"><strong>Strategic Goal:</strong> </h5> <h5 class="text-md font-semibold mt-2"><strong>Strategic Objective:</strong> </h5>',1),wt=f("<div><span> </span></div>"),kt=f('<tr><td><textarea class="input input-bordered w-full resize-none svelte-vxi0bz"></textarea></td><td><textarea class="input input-bordered w-full resize-none svelte-vxi0bz"></textarea></td><td><textarea class="input input-bordered w-full resize-none svelte-vxi0bz"></textarea></td><td><textarea class="input input-bordered w-full resize-none svelte-vxi0bz"></textarea></td><td><button class="btn btn-error btn-sm text-white">Delete</button></td></tr>'),jt=f('<span class="loading loading-spinner">Submitting...</span>'),At=f('<div class="min-h-screen bg-base-300 p-8"><h1 class="text-2xl font-bold mb-4">Action Plans</h1> <!> <!> <div class="overflow-x-auto"><table class="table table-zebra w-full shadow-lg rounded-lg"><thead><tr><th>Actions Taken</th><th>KPI</th><th>Target Output</th><th>Key Person Responsible</th><th>Actions</th></tr></thead><tbody></tbody></table></div> <div class="mt-4 flex gap-4"><button class="btn btn-primary">Add Row</button> <button class="btn btn-secondary"><!></button></div></div>');function Kt(X,Y){ct(Y,!1);const Z=mt(),tt=()=>ft(xt,"$page",Z);let s=_([{actions_taken:"",kpi:"",target_output:"",key_person_responsible:"",objective_id:0,profile_id:""}]),h={actions_taken:"",kpi:"",target_output:"",key_person_responsible:"",objective_id:0,profile_id:""},S=_(null),x=_(null),y=_(""),H=_("info"),g=null,w=_(!1),B="";ht(()=>{const{params:a}=tt();g=parseInt(a.id),g?(h.objective_id=g,pt(s,e(s)[0].objective_id=g),at(g),et()):b("Objective ID is missing.","error")});const et=async()=>{const{data:{user:a}}=await E.auth.getUser();a?B=a.id:b("User not logged in.","error")},at=async a=>{try{const{data:t,error:r}=await E.from("strategic_objectives").select("name, strategic_goal_id").eq("id",a).single();if(r||!t){console.error("Error fetching strategic objective:",r),b("Failed to fetch strategic objective.","error");return}p(S,t);const{data:l,error:d}=await E.from("strategic_goals").select("name, goal_no").eq("id",t.strategic_goal_id).single();if(d||!l){console.error("Error fetching strategic goal:",d),b("Failed to fetch strategic goal.","error");return}p(x,l)}catch(t){console.error("Error fetching strategic objective or goal:",t),b("An error occurred while fetching strategic data.","error")}},rt=()=>{p(s,[...e(s),{...h}])},ot=a=>{p(s,e(s).filter((t,r)=>r!==a))},k=(a,t,r)=>{p(s,e(s).map((l,d)=>d===a?{...l,[t]:r}:l))},st=async()=>{if(e(s).length===0){b("Please add at least one action plan.","warning");return}const a=e(s).map(t=>({...t,profile_id:B||h.profile_id,objective_id:t.objective_id||h.objective_id}));try{p(w,!0);const{data:t,error:r}=await E.from("action_plans").insert(a);r?(console.error("Error submitting action plans:",r.message),b("Failed to submit action plans.","error")):(console.log("Action plans submitted successfully:",t),b("Action plans submitted successfully.","success"),p(s,[]))}catch(t){console.error("Error submitting action plans:",t),b("An error occurred while submitting action plans.","error")}finally{p(w,!1)}},b=(a,t)=>{p(y,a),p(H,t),setTimeout(()=>{p(y,"")},5e3)},j=a=>{const t=a.target;t.style.height="auto",t.style.height=`${t.scrollHeight}px`};gt();var T=At(),C=c(n(T),2);M(C,()=>e(x)&&e(S),a=>{var t=yt(),r=bt(t),l=c(n(r));i(r);var d=c(r,2),m=c(n(d));i(d),q(()=>{K(l,` ${e(x).goal_no??""} - ${e(x).name??""}`),K(m,` ${e(S).name??""}`)}),v(a,t)});var J=c(C,2);M(J,()=>e(y),a=>{var t=wt(),r=n(t),l=n(r,!0);i(r),i(t),q(()=>{_t(t,`alert alert-${e(H)??""} shadow-lg mb-4 svelte-vxi0bz`),K(l,e(y))}),v(a,t)});var O=c(J,2),L=n(O),N=c(n(L));ut(N,5,()=>e(s),vt,(a,t,r)=>{var l=kt(),d=n(l),m=n(d);$(m),i(d);var D=c(d),F=n(D);$(F),i(D);var I=c(D),R=n(I);$(R),i(I);var G=c(I),U=n(G);$(U),i(G);var W=c(G),nt=n(W);i(W),i(l),P(m,()=>e(t).actions_taken,o=>(e(t).actions_taken=o,z(()=>e(s)))),u("input",m,o=>{j(o),k(r,"actions_taken",o.target.value)}),P(F,()=>e(t).kpi,o=>(e(t).kpi=o,z(()=>e(s)))),u("input",F,o=>{j(o),k(r,"kpi",o.target.value)}),P(R,()=>e(t).target_output,o=>(e(t).target_output=o,z(()=>e(s)))),u("input",R,o=>{j(o),k(r,"target_output",o.target.value)}),P(U,()=>e(t).key_person_responsible,o=>(e(t).key_person_responsible=o,z(()=>e(s)))),u("input",U,o=>{j(o),k(r,"key_person_responsible",o.target.value)}),u("click",nt,()=>ot(r)),v(a,l)}),i(N),i(L),i(O);var Q=c(O,2),V=n(Q),A=c(V,2),it=n(A);M(it,()=>e(w),a=>{var t=jt();v(a,t)},a=>{var t=lt("Submit");v(a,t)}),i(A),i(Q),i(T),q(()=>A.disabled=e(w)),u("click",V,rt),u("click",A,st),v(X,T),dt()}export{Kt as component};
