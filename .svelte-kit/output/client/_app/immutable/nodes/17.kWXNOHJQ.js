import{a as p,t as w,c as ae,b as h}from"../chunks/disclose-version.CM6f1PTD.js";import{p as te,a as re,b as u,g as e,f as J,s as l,t as K,m as M,d as x,c as i,r as s,n as le}from"../chunks/runtime.g0my00JR.js";import{e as O}from"../chunks/utils.sCj8HAia.js";import{i as g}from"../chunks/if.DVEvk735.js";import{r as q,s as ie,a as se}from"../chunks/attributes.BVavg5V5.js";import{b as Q}from"../chunks/input.N22HgeA5.js";import{p as oe}from"../chunks/event-modifiers.CWmzcjye.js";import{i as ne}from"../chunks/lifecycle.6aQbxLMK.js";import{p as pe}from"../chunks/props.BjMJLEAs.js";/* empty css                         */import{s as y}from"../chunks/supabaseClient.CaMOPPuz.js";var fe=w('<span class="loading loading-spinner loading-sm"></span> <p class="text-white">Loading...</p>',1),ce=w('<img alt="Profile Picture" class="rounded-full w-32 h-32 mx-auto mb-4">'),ue=w('<h1 class="text-white font-bold text-4xl">Edit Profile</h1> <!> <form class="mt-4"><div class="mb-4"><label for="profile-pic" class="text-white mb-2 cursor-pointer">Profile Picture</label> <div class="relative"><input id="profile-pic" type="file" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"> <button type="button" class="w-full py-2 px-4 border border-gray-300 rounded-lg bg-gray-100 hover:bg-gray-200 focus:outline-none text-gray-700"><!></button></div></div> <div class="mb-4"><label for="first-name" class="text-white">First Name</label> <input id="first-name" type="text" placeholder="Enter first name" class="input input-bordered w-full"></div> <div class="mb-4"><label for="last-name" class="text-white">Last Name</label> <input id="last-name" type="text" placeholder="Enter last name" class="input input-bordered w-full"></div> <div class="mb-4"><label for="role" class="text-white">Role</label> <input id="role" type="text" disabled class="input input-bordered w-full bg-gray-100"></div> <button type="submit" class="btn btn-primary w-full"><!></button></form>',1),de=w('<div class="hero min-h-screen bg-base-300 overflow-y-auto"><div class="hero-content flex flex-col items-center justify-center"><div class="max-w-md text-center"><!></div></div></div>');function Ee(T,D){te(D,!1);let V=pe(D,"data",8);const{session:d}=V();let a=x(null),F=x(!0),_=x(!1),c=null,m=x(null);const W=async()=>{if(d){const{user:o}=d,{data:t,error:f}=await y.from("profiles").select("first_name, last_name, email, role, profile_pic").eq("id",o.id).single();f?console.error("Error fetching user profile:",f.message):(u(a,t),u(m,e(a).profile_pic||null))}u(F,!1)},N=async()=>{if(e(a)&&d){u(_,!0);const{user:o}=d;let t=e(a).profile_pic;if(c){console.log("Uploading new profile picture...");const{data:v,error:b}=await y.storage.from("profile-pictures").upload(`public/${o.id}/${c.name}`,c,{cacheControl:"3600",upsert:!0});b?console.error("Error uploading profile picture:",b.message):v&&(console.log("Upload successful:",v),t=y.storage.from("profile-pictures").getPublicUrl(v.path).data.publicUrl,console.log("Public URL of profile picture:",t),u(m,t))}const{error:f}=await y.from("profiles").update({first_name:e(a).first_name,last_name:e(a).last_name,email:e(a).email,profile_pic:t}).eq("id",o.id);f?console.error("Error updating profile:",f.message):(console.log("Profile updated successfully!"),alert("Profile updated successfully!")),u(_,!1)}},X=async o=>{const t=o.target;c=t.files?t.files[0]:null,c&&(console.log("Selected file for upload:",c.name),N())};W(),ne();var P=de(),R=i(P),j=i(R),Y=i(j);g(Y,()=>e(F),o=>{var t=fe();le(2),p(o,t)},o=>{var t=ae(),f=J(t);g(f,()=>d!==null&&e(a),v=>{var b=ue(),k=l(J(b),2);g(k,()=>e(m),r=>{var n=ce();K(()=>ie(n,"src",e(m))),p(r,n)});var U=l(k,2),E=i(U),$=l(i(E),2),z=i($),A=l(z,2),Z=i(A);g(Z,()=>e(m),r=>{var n=h("Change Image");p(r,n)},r=>{var n=h("Upload Image");p(r,n)}),s(A),s($),s(E);var C=l(E,2),B=l(i(C),2);q(B),s(C);var I=l(C,2),G=l(i(I),2);q(G),s(I);var L=l(I,2),H=l(i(L),2);q(H),s(L);var S=l(L,2),ee=i(S);g(ee,()=>e(_),r=>{var n=h("Saving...");p(r,n)},r=>{var n=h("Save Profile");p(r,n)}),s(S),s(U),K(()=>{se(H,e(a).role),S.disabled=e(_)}),O("change",z,X),Q(B,()=>e(a).first_name,r=>M(a,e(a).first_name=r)),Q(G,()=>e(a).last_name,r=>M(a,e(a).last_name=r)),O("submit",U,oe(N)),p(v,b)},null,!0),p(o,t)}),s(j),s(R),s(P),p(T,P),re()}export{Ee as component};
